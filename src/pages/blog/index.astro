---
import type { CollectionEntry } from "astro:content";
import { getCollection } from "astro:content";
import PostArt from "../../components/art/PostArt.astro";
import Base from "../../layouts/Base.astro";

const allPosts = await getCollection("blog");
const posts = allPosts
  .filter((post: CollectionEntry<"blog">) => !post.data.draft)
  .sort(
    (a: CollectionEntry<"blog">, b: CollectionEntry<"blog">) =>
      b.data.date.valueOf() - a.data.date.valueOf(),
  );
---

<Base title="Blog — Robo House" description="Words from Kevin Wynn.">
  <main class="min-h-screen bg-cream text-ink font-mono">
    <!-- NAV -->
    <nav
      class="fixed top-0 left-0 right-0 z-50 flex justify-between items-center px-6 py-5"
    >
      <a
        href="/"
        class="text-xs tracking-ultra uppercase font-mono hover:text-red transition-colors"
        ><span class="italic" style="color:var(--red)">ROBO</span> HOUSE</a
      >
      <div class="flex gap-8 text-xs tracking-widest uppercase">
        <a href="/#work" class="hover:text-red transition-colors duration-300"
          >Work</a
        >
        <a href="/blog" class="text-red">Blog</a>
        <a href="/#about" class="hover:text-red transition-colors duration-300"
          >About</a
        >
      </div>
    </nav>

    <!-- HEADER -->
    <section class="pt-40 pb-16 px-6 md:px-12 border-b border-ink/10">
      <h1
        class="font-condensed font-black italic text-5xl md:text-8xl tracking-tight mb-4"
      >
        THE BLOG
      </h1>
      <p class="text-xs tracking-widest text-muted uppercase">
        {posts.length}
        {posts.length === 1 ? "post" : "posts"}
      </p>
    </section>

    <!-- POSTS LIST -->
    <section class="px-6 md:px-12">
      {
        posts.length === 0 ? (
          <div class="py-24 text-center">
            <p class="text-xs tracking-widest text-muted uppercase">
              Nothing yet. Check back.
            </p>
          </div>
        ) : (
          <div class="grid grid-cols-1 md:grid-cols-2 gap-px bg-ink/10">
            {posts.map((post: CollectionEntry<"blog">) => (
              <a
                href={`/blog/${post.slug}`}
                class="group bg-cream flex flex-col cursor-crosshair hover:bg-ink transition-colors duration-500"
              >
                <div class="overflow-hidden">
                  <PostArt art={post.data.art} compact={true} />
                </div>
                <div class="p-8 flex flex-col gap-3 flex-1">
                  <span class="text-xs tracking-widest text-muted uppercase group-hover:text-cream/50 transition-colors">
                    {post.data.date.toLocaleDateString("en-US", {
                      year: "numeric",
                      month: "short",
                      day: "numeric",
                    })}
                  </span>
                  <h2 class="font-condensed font-black text-2xl md:text-3xl italic tracking-tight group-hover:text-cream transition-colors leading-tight">
                    {post.data.title}
                  </h2>
                  <p class="text-xs tracking-wide text-muted leading-relaxed group-hover:text-cream/60 transition-colors">
                    {post.data.description}
                  </p>
                  <span class="text-xs tracking-widest text-muted uppercase mt-auto pt-2 group-hover:text-cream/50 transition-colors">
                    Read →
                  </span>
                </div>
              </a>
            ))}
          </div>
        )
      }
    </section>

    <!-- FOOTER -->
    <footer
      class="px-6 md:px-12 py-12 border-t border-ink/10 mt-24 flex flex-col md:flex-row justify-between items-start md:items-center gap-6"
    >
      <a
        href="/"
        class="font-condensed font-black text-2xl tracking-tight hover:opacity-70 transition-opacity"
      >
        <span class="italic" style="color:var(--red)">ROBO</span> HOUSE
      </a>
      <p class="text-xs tracking-widest text-muted uppercase">© 2025</p>
    </footer>
  </main>
</Base>
